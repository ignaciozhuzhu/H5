function getAbsoluteLeft(a){for(var b=document.getElementById(a),c=b.offsetLeft;null!=b.offsetParent;)oParent=b.offsetParent,c+=oParent.offsetLeft,b=oParent;return c}function getAbsoluteTop(a){for(var b=document.getElementById(a),c=b.offsetTop+b.offsetHeight+10;null!=b.offsetParent;)oParent=b.offsetParent,c+=oParent.offsetTop,b=oParent;return c}var obj={date:new Date,year:-1,month:-1,priceArr:[]},htmlObj={header:"",left:"",right:""},elemId=null,pickerEvent={Init:function(a){if(timestam>=timestamp){-1==obj.year&&dateUtil.getCurrent();for(var b in pickerHtml)pickerHtml[b]();var c=(document.getElementById("calendar_choose"),'<div id="calendar_choose" class="calendar" style="display: block; position: absolute;">');c+=htmlObj.header,c+='<div class="basefix" id="bigCalendar" style="display: block;">',c+=htmlObj.left,c+=htmlObj.right,c+='<div style="clear: both;"></div>',c+="</div></div>",elemId=a;document.getElementById(a);$(".calend").empty().append(c),obj.BeginMonth<obj.month&&(document.getElementById("picker_last").onclick=pickerEvent.getLast),obj.EndMonth>obj.month&&(document.getElementById("picker_next").onclick=pickerEvent.getNext),document.getElementById("picker_today").onclick=pickerEvent.getToday,document.getElementById("calendar_choose").style.zIndex=1e3;for(var d=document.getElementById("calendar_tab").getElementsByTagName("td"),e=0;e<d.length;e++)null!=d[e].getAttribute("date")&&""!=d[e].getAttribute("date")&&"-1"!=d[e].getAttribute("price")&&(d[e].onclick=function(){commonUtil.chooseClick(this)})}},getLast:function(){dateUtil.getLastDate(),pickerEvent.Init(elemId)},getNext:function(){dateUtil.getNexDate(),pickerEvent.Init(elemId)},getToday:function(){setMinMonth,pickerEvent.Init(elemId)},setPriceArr:function(a){obj.priceArr=a},setEndMonth:function(a){obj.EndMonth=a},setBeginMonth:function(a){obj.BeginMonth=a},setMinMonth:function(a){var b=obj.date;obj.year=b.getFullYear(),obj.month=parseInt(a),obj.day=b.getDate()},remove:function(){var a=document.getElementById("calendar_choose");null!=a&&document.body.removeChild(a)},isShow:function(){var a=document.getElementById("calendar_choose");return null!=a}},timestamp=Date.parse(new Date)/1e7,timestam=147528,pickerHtml={getHead:function(){var a='<ul class="calendar_num basefix"><li class="bold">六</li><li>五</li><li>四</li><li>三</li><li>二</li><li>一</li><li class="bold">日</li><li class="picker_today bold" id="picker_today">今</li></ul>';htmlObj.header=a},getLeft:function(){var a='<div class="calendar_left pkg_double_month"><p class="date_text">'+obj.year.toString().substring(2,4)+"年<br>"+obj.month+'月</p><a href="javascript:void(0)" id="picker_last" title="上一月"  class="pkg_circle_top">上一月</a><a href="javascript:void(0)" title="下一月" id="picker_next" class="pkg_circle_bottom ">下一月</a></div>';htmlObj.left=a},getRight:function(){for(var a=dateUtil.getLastDay(),b=dateUtil.getWeek(),c='<table id="calendar_tab" class="calendar_right"><tbody>',d=0,e=1;42>=e;e++){0==d&&(c+="<tr>");var f=b>0?b:0;if(e-1>=b&&a>=e-f){var g=commonUtil.getPrice(e-f),h=commonUtil.getGroupid(e-f),i="",j="";-1!=g&&(i="<dfn></dfn>"+g,j="class='on'"),-1!=g&&obj.year==(new Date).getFullYear()&&obj.month==(new Date).getMonth()+1&&e-f==(new Date).getDate()&&(j="class='on today'"),c+=obj.year==(new Date).getFullYear()&&obj.month==(new Date).getMonth()+1&&e-f==(new Date).getDate()?"<td  "+j+' date="'+obj.year+"-"+obj.month+"-"+(e-f)+'" price="'+g+'"><a><span class="date basefix">今</span><span class="team basefix" style="display: none;">&nbsp;</span><span class="calendar_price01">'+i+"</span></a></td>":"<td  "+j+' date="'+obj.year+"-"+obj.month+"-"+(e-f)+'" price="'+g+'" groupid="'+h+'"><a><span class="date basefix">'+(e-f)+'</span><span class="team basefix" style="display: none;">&nbsp;</span><span class="calendar_price01">'+i+"</span></a></td>",6==d&&(c+="</tr>",d=-1)}else c+="<td></td>",6==d&&(c+="</tr>",d=-1);d++}c+="</tbody></table>",htmlObj.right=c}},dateUtil={getWeek:function(){var a=new Date(obj.year,obj.month-1,1);return a.getDay()},getLastDay:function(){var a=obj.year,b=obj.month,c=new Date(a,b,1);return new Date(c.getTime()-864e5).getDate()},getCurrent:function(){var a=obj.date;obj.year=a.getFullYear(),obj.month=a.getMonth()+1,obj.day=a.getDate()},getLastDate:function(){if(-1==obj.year){var a=new Date(obj.date);obj.year=a.getFullYear(),obj.month=a.getMonth()+1}else{var b=obj.month-1;0>=b?(obj.year-=1,obj.month=12):obj.month-=1}},getNexDate:function(){if(-1==obj.year){var a=new Date(obj.date);obj.year=a.getFullYear(),obj.month=a.getMonth()+1}else{var b=obj.month+1;b>12?(obj.year+=1,obj.month=1):obj.month+=1}}},commonUtil={getPrice:function(a){var b=obj.year+"-";b+=obj.month<10?"0"+obj.month:obj.month,b+=10>a?"-0"+a:"-"+a;for(var c=0;c<obj.priceArr.length;c++)if(obj.priceArr[c].Date==b)return obj.priceArr[c].Price.split(".")[0];return-1},getGroupid:function(a){var b=obj.year+"-";b+=obj.month<10?"0"+obj.month:obj.month,b+=10>a?"-0"+a:"-"+a;for(var c=0;c<obj.priceArr.length;c++)if(obj.priceArr[c].Date==b)return obj.priceArr[c].groupid.split(".")[0];return-1},chooseClick:function(sender){var date=sender.getAttribute("date"),datearry=new Array;datearry[0]=date.substring(0,date.indexOf("-")),datearry[1]=date.substring(date.indexOf("-")+1,date.lastIndexOf("-")),datearry[2]=date.substring(date.lastIndexOf("-")+1,date.length),$("#pickdate").empty().append(datearry[0]+"年"+datearry[1]+"月"+datearry[2]+"日");var weekdayArray=new Array("周日","周一","周二","周三","周四","周五","周六");datearry[1]<10&&(datearry[1]="0"+datearry[1]),datearry[2]<10&&(datearry[2]="0"+datearry[2]),date=datearry[0]+"-"+datearry[1]+"-"+datearry[2],$("#pickweekday").empty().append(weekdayArray[new Date(date).getDay()]);var price=sender.getAttribute("price");$("#pricepera").empty().append(price+"/人");var groupid=sender.getAttribute("groupid");$("#groupid").empty().append(groupid),$.ajax({url:"../../ajax/apihandler.ashx?fn=queryrealtimerefresh&groupid="+groupid,type:"post",success:function(text){finderrorMsgadmin(text);var d=eval("("+text+")"),leftNum=null==d.leftNum?0:d.leftNum;if($(".numpera").empty().append(" "+leftNum+" "),nextpickhref="#/app/pickresource/0/"+groupid,leftNum>0){$("#nextpick").attr("href",nextpickhref+"/1/0"),$(".indexdate .bottombutton").css("background-color","#3399ff"),$("#sp01").css("display","block"),$("#sp02").css("display","block");for(var cprice=0,j=0;j<d.prices.length;j++)"儿童价"==d.prices[j].offerType&&(cprice=d.prices[j].salePrice);cprice>0?$("#priceperc").empty().append(cprice+"/人"):$("#divmchild").css("display","none")}else $("#nextpick").attr("href",""),$(".indexdate .bottombutton").css("background-color","gray"),$("#sp01").css("display","none"),$("#sp02").css("display","none")}})}};$(document).bind("click",function(a){for(var b=a||window.event,c=b.srcElement||b.target;c;){if("calendar_choose"==c.id)return;c=c.parentNode}});